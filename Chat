<%@ page language="java" contentType="text/html; charset=UTF-8"
         pageEncoding="UTF-8"%>
<%@ page import="poly.util.CmmUtil"%>
<!DOCTYPE html>
<html>
<head>
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script>

        //채팅방 전체 대화 가져오기
        function getAllMsg() {
            //Ajax 호출
            $.ajax({
                url : "/chat/getMsg.do",
                type : "post",
                dataType : "JSON",
                data : $("form").serialize(),
                success : function(json) {
                    $("#view_json").html("getAllMsg : " + json);
                    //메시지 출력하기
                    doOutputMsg(json);
                }
            })
        }

        // 대화 메시지 전체 출력하기
        function doOutputMsg(json) {
            // 메시지 대화가 존재하면 출력
            if (json != null) {
                var msgResult = "";
                for (var i = 0; i < json.length; i++) {
                    msgResult += (json[i].msg);
                    msgResult += (" | " + json[i].userNm)
                    msgResult += (" | " + json[i].dateTime + "<br/>");
                }
                $("#total_msg").html(msgResult);
            }
        }

    function sendMsg() {
        $.ajax({

            url: "/chat/msg.do",
            type: "post",
            dataType: "JSON",
            data: $("form").serialize(),
            success: function (json) {
                //메시지 출력하기
                if (json != null) {
                    var msgResult = "";
                    for (var i = 0; i < json.length; i++) {
                        msgResult += (json[i].msg);
                        msgResult += (" | " + json[i].userNm)
                        msgResult += (" | " + json[i].dateTime + "<br/>");
                    }
                    $("#total_msg").html(msgResult);
                }
            }

        })
    };
    </script>
</head>
<body>
<h1>
   단체 채팅방 '음성대화' 전체 내용
</h1>
<hr />
    <div id="total_msg"></div>

<h1>내가 방금 말한 전송 메시지</h1>
<hr />
<div id="view_msg"></div>
<br />
<h1>채팅방 전체 리스트</h1>
<hr />
<div id="room_list"></div>

<!-- 음성 인식 데이터를 전송하기 위한 폼 -->
<form name="form" method="post">
    <input type="text" name="send_msg" id="send_msg" />
    <button type="submit" onclick="sendMsg()" ></button>
</form>

</body>
</html>
